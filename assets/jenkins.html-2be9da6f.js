import{_ as a,X as s,Y as e,Z as i,$ as n,a3 as t}from"./framework-8e4c1295.js";const o="/assets/1682879599402-deb9224f.png",l="/assets/1682878254783-80f42634.png",c="/assets/1682878481278-91a60326.png",p="/assets/1682879989987-1a5cdea1.png",r="/assets/1682880056857-85e907b9.png",d="/assets/1682880105953-268f86b3.png",u="/assets/1682880770049-269a86ea.png",g="/assets/1682880814250-2bf619dc.png",k="/assets/1682880890182-109f2f71.png",b="/assets/1682880937833-d07446b7.png",m="/assets/1682881098585-1c58d578.png",h="/assets/1682881292360-a5175597.png",v="/assets/1682881861972-ddff1ce1.png",f="/assets/1682881928041-5b7e8d57.png",_="/assets/1682881954453-4d26299b.png",x="/assets/1682882150379-4af08921.png",y="/assets/1682882322667-17092499.png",j="/assets/1682882430022-0366da27.png",z="/assets/1682882722058-8a65f585.png",w="/assets/1682882754508-88e26675.png",q="/assets/1682882998050-f5316891.png",S={},G=n("div",{class:"hint-container tip"},[n("p",{class:"hint-container-title"},"✨✨✨✨✨"),n("p",null,"Jenkins是一个开源的自动化服务器，可以帮助软件开发人员自动化构建、测试和部署他们的项目。它支持多种编程语言和工具，并且可以与许多其他工具和服务集成，如Git、Docker、AWS、Slack等。Jenkins还提供了一个易于使用的Web界面，可以方便地配置和管理自动化流程。")],-1),W=t(`<h2 id="安装-jenkins" tabindex="-1"><a class="header-anchor" href="#安装-jenkins" aria-hidden="true">#</a> 安装 Jenkins</h2><p>部署环境： ConterOS 7 + Docker Compose</p><h3 id="新建-jenkins-yml-文件-输入以下内容" tabindex="-1"><a class="header-anchor" href="#新建-jenkins-yml-文件-输入以下内容" aria-hidden="true">#</a> 新建 jenkins.yml 文件，输入以下内容：</h3><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">&#39;3&#39;</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>
  <span class="token key atrule">jenkins</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> jenkins/jenkins<span class="token punctuation">:</span>jdk11
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;8100:8080&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;50000:50000&quot;</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/var/jenkins_home:/var/jenkins_home&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span>
      <span class="token punctuation">-</span> <span class="token string">&quot;/usr/bin/docker:/usr/bin/docker&quot;</span>
      <span class="token comment"># 这三个目录需要执行 chmod 777 授权</span>
    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="为相应文件授权" tabindex="-1"><a class="header-anchor" href="#为相应文件授权" aria-hidden="true">#</a> 为相应文件授权</h3><p>权限不足可能造成之后 Jenkins 流水线失败</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">chmod</span> <span class="token number">777</span> /var/jenkins_home
<span class="token function">chmod</span> <span class="token number">777</span> /var/run/docker.sock
<span class="token function">chmod</span> <span class="token number">777</span> usr/bin/docker
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="运行-jenkins-yml-脚本创建容器" tabindex="-1"><a class="header-anchor" href="#运行-jenkins-yml-脚本创建容器" aria-hidden="true">#</a> 运行 jenkins.yml 脚本创建容器</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker-compose</span> <span class="token parameter variable">-f</span> jenkins.yml up <span class="token parameter variable">-d</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>访问：[ip]:8100 会看到如下 Jenkins 页面：</p><figure><img src="`+o+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>根据提示访问对应文件路径即可拿到管理员密码。</p><h3 id="安装插件" tabindex="-1"><a class="header-anchor" href="#安装插件" aria-hidden="true">#</a> 安装插件</h3><p>输入管理员密码后点击 继续，将会进入插件安装界面：</p><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>安装推荐的插件即可。</p><figure><img src="'+c+'" alt="等待安装插件" tabindex="0" loading="lazy"><figcaption>等待安装插件</figcaption></figure><p>等待插件安装完成。</p><p>若安装插件的过程中出现多个插件安装失败(版本不兼容)的情况，可参考<a href="#%E6%8F%92%E4%BB%B6%E5%AE%89%E8%A3%85%E5%A4%B1%E8%B4%A5">常见问题</a></p><h3 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户" aria-hidden="true">#</a> 创建用户</h3><figure><img src="'+p+'" alt="创建用户" tabindex="0" loading="lazy"><figcaption>创建用户</figcaption></figure><p>根据提示输入即可。</p><h3 id="实例配置" tabindex="-1"><a class="header-anchor" href="#实例配置" aria-hidden="true">#</a> 实例配置</h3><figure><img src="'+r+'" alt="实例配置" tabindex="0" loading="lazy"><figcaption>实例配置</figcaption></figure><p>直接下一步。</p><h3 id="安装完成" tabindex="-1"><a class="header-anchor" href="#安装完成" aria-hidden="true">#</a> 安装完成</h3><figure><img src="'+d+'" alt="完成" tabindex="0" loading="lazy"><figcaption>完成</figcaption></figure><h2 id="创建测试web应用" tabindex="-1"><a class="header-anchor" href="#创建测试web应用" aria-hidden="true">#</a> 创建测试Web应用</h2><ol><li>创建 <code>.Net Core Web</code> 应用程序</li><li>为项目添加 DockerFile 支持</li><li>将项目代码上传至 gitee 仓库</li></ol><h2 id="创建-jenkins-任务" tabindex="-1"><a class="header-anchor" href="#创建-jenkins-任务" aria-hidden="true">#</a> 创建 Jenkins 任务</h2><ol><li><p><strong>首页点击 <code>新建任务</code></strong></p><figure><img src="'+u+'" alt="新建任务" tabindex="0" loading="lazy"><figcaption>新建任务</figcaption></figure></li><li><p><strong>输入 <code>任务名称</code></strong></p><figure><img src="'+g+'" alt="输入任务名称" tabindex="0" loading="lazy"><figcaption>输入任务名称</figcaption></figure></li><li><p><strong>选择 <code>自由风格</code> 的任务，进入下一步</strong></p><figure><img src="'+k+'" alt="自由风格" tabindex="0" loading="lazy"><figcaption>自由风格</figcaption></figure></li><li><p><strong>随便输入描述</strong></p><figure><img src="'+b+'" alt="描述" tabindex="0" loading="lazy"><figcaption>描述</figcaption></figure></li><li><p><strong>源码管理</strong></p><p>按照如下配置：</p><figure><img src="'+m+'" alt="源码管理配置" tabindex="0" loading="lazy"><figcaption>源码管理配置</figcaption></figure><p>其中，<code>Repository URL</code> 为仓库地址。</p><p>格式为：<code>https://[gitee账号]:[gitee密码]@gitee.com/[空间名称]/[仓库名称].git</code></p></li><li><p><strong>构建环境</strong></p><figure><img src="'+h+`" alt="构建环境" tabindex="0" loading="lazy"><figcaption>构建环境</figcaption></figure></li><li><p><strong>Build Steps</strong></p><p>选择 <code>执行 Shell</code>，填入下面的 Shell 脚本：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> <span class="token comment">#!/bin/bash</span>
 <span class="token comment"># 加载环境变量</span>
 <span class="token builtin class-name">source</span> /etc/profile

 <span class="token builtin class-name">echo</span> ----------获取短版本号----------
 <span class="token assign-left variable">SHORT_VERSION</span><span class="token operator">=</span><span class="token variable"><span class="token variable">\`</span><span class="token function">git</span> rev-parse <span class="token parameter variable">--short</span> HEAD<span class="token variable">\`</span></span>
 <span class="token builtin class-name">echo</span> <span class="token variable">$SHORT_VERSION</span>

 <span class="token builtin class-name">echo</span> ----------移动Dockerfile文件到当前文件夹----------
 <span class="token function">cp</span> src/<span class="token punctuation">[</span>Web项目文件夹<span class="token punctuation">]</span>/Dockerfile <span class="token builtin class-name">.</span>

 <span class="token builtin class-name">echo</span> ----------打包镜像----------
 <span class="token function">docker</span> build <span class="token parameter variable">-t</span> identity.image:<span class="token variable">$SHORT_VERSION</span> <span class="token builtin class-name">.</span>

 <span class="token builtin class-name">echo</span> ----------标记最新版本----------
 <span class="token function">docker</span> tag identity.image:<span class="token variable">$SHORT_VERSION</span> identity.image:latest

 <span class="token builtin class-name">echo</span> ----------如果容器存在，则停止并删除旧的容器----------
 <span class="token assign-left variable">CID</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">docker</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;identity&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $1}&#39;</span><span class="token variable">)</span></span>
 <span class="token builtin class-name">echo</span> <span class="token variable">$CID</span>
 <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$CID</span>&quot;</span> <span class="token operator">!=</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
     <span class="token builtin class-name">echo</span> ----------停止当前运行的容器----------
     <span class="token function">docker</span> stop <span class="token variable">$CID</span>
     <span class="token builtin class-name">echo</span> ----------删除当前运行的容器----------
     <span class="token function">docker</span> <span class="token function">rm</span> <span class="token variable">$CID</span>
 <span class="token keyword">fi</span>

 <span class="token builtin class-name">echo</span> ----------重新创建容器----------
 <span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> identity <span class="token parameter variable">-p</span> <span class="token number">6100</span>:80 <span class="token parameter variable">-p</span> <span class="token number">443</span>:443 identity.image:latest <span class="token parameter variable">--restart</span><span class="token operator">=</span>always

 <span class="token builtin class-name">echo</span> ----------删除所有none的镜像----------
 <span class="token function">docker</span> rmi <span class="token variable"><span class="token variable">\`</span><span class="token function">docker</span> images <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">&quot;&lt;none&gt;&quot;</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">&#39;{print $3}&#39;</span><span class="token variable">\`</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><p>配置完成后保存即可。</p><h2 id="手动执行-jenkins-任务" tabindex="-1"><a class="header-anchor" href="#手动执行-jenkins-任务" aria-hidden="true">#</a> 手动执行 Jenkins 任务</h2><h3 id="立即构建" tabindex="-1"><a class="header-anchor" href="#立即构建" aria-hidden="true">#</a> 立即构建</h3><p>在任务页面点击 <code>立即构建</code> 执行任务</p><figure><img src="`+v+'" alt="立即构建" tabindex="0" loading="lazy"><figcaption>立即构建</figcaption></figure><h3 id="查看控制台输出" tabindex="-1"><a class="header-anchor" href="#查看控制台输出" aria-hidden="true">#</a> 查看控制台输出</h3><figure><img src="'+f+'" alt="点击 任务序号" tabindex="0" loading="lazy"><figcaption>点击 任务序号</figcaption></figure><figure><img src="'+_+'" alt="点击 控制台输出" tabindex="0" loading="lazy"><figcaption>点击 控制台输出</figcaption></figure><p>显示如下内容说明构建成功：</p><figure><img src="'+x+'" alt="构建成功" tabindex="0" loading="lazy"><figcaption>构建成功</figcaption></figure><p>此时即可访问 [ip]:6100 查看部署的 Web 页面</p><h2 id="配置-gitee-webhooks" tabindex="-1"><a class="header-anchor" href="#配置-gitee-webhooks" aria-hidden="true">#</a> 配置 Gitee WebHooks</h2><h3 id="安装-gitee-插件" tabindex="-1"><a class="header-anchor" href="#安装-gitee-插件" aria-hidden="true">#</a> 安装 Gitee 插件</h3><ol><li><p><strong>进入 Jenkins 插件管理页面</strong></p><figure><img src="'+y+'" alt="插件管理" tabindex="0" loading="lazy"><figcaption>插件管理</figcaption></figure></li><li><p><strong>搜索 <code>gitee</code> 插件并安装</strong></p><figure><img src="'+j+'" alt="安装 gitee 插件" tabindex="0" loading="lazy"><figcaption>安装 gitee 插件</figcaption></figure></li></ol><h3 id="配置-gitee-触发器" tabindex="-1"><a class="header-anchor" href="#配置-gitee-触发器" aria-hidden="true">#</a> 配置 Gitee 触发器</h3><p>打开之前创建的 jenkins 任务的配置页面，按照如下内容配置触发器：</p><figure><img src="'+z+'" alt="Gitee 触发器" tabindex="0" loading="lazy"><figcaption>Gitee 触发器</figcaption></figure><p>这里的 Gitee WebHook 地址等下要用。</p><figure><img src="'+w+'" alt="Gitee 触发器" tabindex="0" loading="lazy"><figcaption>Gitee 触发器</figcaption></figure><p>生成 Gitee WebHook 密码</p><h3 id="配置-gitee-webhooks-1" tabindex="-1"><a class="header-anchor" href="#配置-gitee-webhooks-1" aria-hidden="true">#</a> 配置 Gitee WebHooks</h3><p>打开 web 应用程序的 gitee 仓库的 WebHooks 管理页面，将上一步中的 Gitee WebHook 地址和密码填入对应位置，勾选触发事件，保存即可。</p><figure><img src="'+q+`" alt="Gitee WebHooks" tabindex="0" loading="lazy"><figcaption>Gitee WebHooks</figcaption></figure><h2 id="完成" tabindex="-1"><a class="header-anchor" href="#完成" aria-hidden="true">#</a> 完成</h2><h2 id="常见问题" tabindex="-1"><a class="header-anchor" href="#常见问题" aria-hidden="true">#</a> 常见问题</h2><h3 id="插件安装失败" tabindex="-1"><a class="header-anchor" href="#插件安装失败" aria-hidden="true">#</a> 插件安装失败</h3><h4 id="更新-docker-为最新版本" tabindex="-1"><a class="header-anchor" href="#更新-docker-为最新版本" aria-hidden="true">#</a> 更新 docker 为最新版本</h4><h4 id="更新-jenkins-为最新版本" tabindex="-1"><a class="header-anchor" href="#更新-jenkins-为最新版本" aria-hidden="true">#</a> 更新 jenkins 为最新版本</h4><ol><li><p>从官网下载最新的 jenkins.war 包并上传至部署 Jenkins 的服务器</p></li><li><p>删除容器中旧的 jenkins.war 包</p></li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 进入容器</span>
<span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token parameter variable">-u</span> root <span class="token punctuation">[</span>container_id<span class="token punctuation">]</span> /bin/bash
<span class="token comment"># 删除旧的 jenkins.war 包</span>
<span class="token function">rm</span> /usr/share/jenkins/jenkins.war
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>将下载的 jenkins.war 包复制进容器中</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> <span class="token function">cp</span> jenkins.war  <span class="token punctuation">[</span>container_id<span class="token punctuation">]</span>:/usr/share/jenkins
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="4"><li>重启容器</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">docker</span> restart <span class="token punctuation">[</span>container_id<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,65);function E(H,D){return s(),e("div",null,[G,i(" more "),W])}const R=a(S,[["render",E],["__file","jenkins.html.vue"]]);export{R as default};
