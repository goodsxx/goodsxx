import{_ as u}from"./plugin-vue_export-helper-c27b6911.js";import{r as i,o as k,c as r,b as l,w as a,e as p,a as n,d as s}from"./app-e2ce661c.js";const m="/assets/1678764104231-41f07a81.png",d="/assets/1678768614953-43222aff.png",b={},v=p('<div class="hint-container tip"><p class="hint-container-title">✨✨✨✨✨</p><p>工作队列模式（Work Queue Mode）是一个常见的消息队列应用模式，通常是一个生产者对多个消费者的模型。在该模式下，生产者将待处理的任务放入队列中，由多个消费者从队列中获取任务并进行处理。例如将耗时的任务异步地分配给多个工作者进行处理。在工作队列中，消息生产者将待处理的任务放入队列中，由一组工作者来竞争性地消费这些任务，并将处理结果返回给消息代理或存储到数据仓库中。</p></div><h2 id="介绍" tabindex="-1"><a class="header-anchor" href="#介绍" aria-hidden="true">#</a> 介绍</h2><p>工作队列模式（Work Queue Mode）是一个常见的消息队列应用模式，通它包括一个或多个生产者将消息发送到队列中，然后一个或多个消费者从该队列接收并处理消息。工作队列模式的特点在于可以在多个消费者之间分配和平衡负载，并且可以确保每个消息只被消费一次。</p><figure><img src="'+m+'" alt="工作队列模式" tabindex="0" loading="lazy"><figcaption>工作队列模式</figcaption></figure><h2 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景" aria-hidden="true">#</a> 使用场景</h2><p>工作队列模式适用于需要处理大量任务的场景，例如：</p><ul><li>后台任务处理：通过将任务放入队列中，让多个消费者异步处理任务，从而提高系统的吞吐量和性能。</li><li>负载均衡：通过多个消费者共同处理队列中的任务，实现任务的分配和负载均衡。</li></ul><h2 id="循环调度" tabindex="-1"><a class="header-anchor" href="#循环调度" aria-hidden="true">#</a> 循环调度</h2><p>在循环调度模式中，RabbitMQ 会尝试将消息平均分配给所有可用的消费者，而不考虑每个消费者的处理能力和负载情况。当消费者数量不变时，每个消费者将在轮换周期内依次接收到消息。</p><h3 id="代码示例" tabindex="-1"><a class="header-anchor" href="#代码示例" aria-hidden="true">#</a> 代码示例</h3>',10),g=n("div",{class:"language-csharp line-numbers-mode","data-ext":"cs"},[n("pre",{class:"language-csharp"},[n("code",null,[n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("System"),n("span",{class:"token punctuation"},"."),s("Text")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 创建ConnectionFactory实例，设置RabbitMQ节点的主机名"),s(`
`),n("span",{class:"token class-name"},"ConnectionFactory"),s(" factory "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    HostName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"192.168.3.100"'),n("span",{class:"token punctuation"},","),s(`
    Port `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5672"),n("span",{class:"token punctuation"},","),s(`
    UserName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),n("span",{class:"token punctuation"},","),s(`
    Password `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" connection "),n("span",{class:"token operator"},"="),s(" factory"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateConnection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建连接"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" channel "),n("span",{class:"token operator"},"="),s(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateModel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建通道"),s(`

`),n("span",{class:"token comment"},"// 声明队列，如果该队列不存在，则会自动创建"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"QueueDeclare"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"durable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"//设置队列为持久化"),s(`
                     exclusive`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoDelete"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"arguments"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 设置消息为持久化"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" properties "),n("span",{class:"token operator"},"="),s(" channel"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateBasicProperties"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
properties`),n("span",{class:"token punctuation"},"."),s("Persistent "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token keyword"},"for"),s(),n("span",{class:"token punctuation"},"("),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"int")]),s(" i "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),s(" i "),n("span",{class:"token operator"},"<"),s(),n("span",{class:"token number"},"10"),n("span",{class:"token punctuation"},";"),s(" i"),n("span",{class:"token operator"},"++"),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"string")]),s(" message "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"任务消息 '),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"i"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 待发送的消息"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" body "),n("span",{class:"token operator"},"="),s(" Encoding"),n("span",{class:"token punctuation"},"."),s("UTF8"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetBytes"),n("span",{class:"token punctuation"},"("),s("message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 将消息转换成字节数组"),s(`

    `),n("span",{class:"token comment"},"// 发布消息到队列中，exchange参数为空表示默认交换器"),s(`
    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicPublish"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"exchange"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'""'),n("span",{class:"token punctuation"},","),s(`
                         `),n("span",{class:"token named-parameter punctuation"},"routingKey"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 消息的路由键为work_queue"),s(`
                         basicProperties`),n("span",{class:"token punctuation"},":"),s(" properties"),n("span",{class:"token punctuation"},","),s(`
                         `),n("span",{class:"token named-parameter punctuation"},"body"),n("span",{class:"token punctuation"},":"),s(" body"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"[生产者] 发送消息：{0}"'),n("span",{class:"token punctuation"},","),s(" message"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 输出发送的消息内容"),s(`
`),n("span",{class:"token punctuation"},"}"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"按[Enter]键退出"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ReadLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 阻塞等待用户按回车键"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),h=n("div",{class:"language-csharp line-numbers-mode","data-ext":"cs"},[n("pre",{class:"language-csharp"},[n("code",null,[n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client"),n("span",{class:"token punctuation"},"."),s("Events")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("System"),n("span",{class:"token punctuation"},"."),s("Text")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 创建连接工厂对象，指定主机名和登录凭据信息"),s(`
`),n("span",{class:"token class-name"},"ConnectionFactory"),s(" factory "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    HostName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"192.168.3.100"'),n("span",{class:"token punctuation"},","),s(`
    Port `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5672"),n("span",{class:"token punctuation"},","),s(`
    UserName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),n("span",{class:"token punctuation"},","),s(`
    Password `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" connection "),n("span",{class:"token operator"},"="),s(" factory"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateConnection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建连接"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" channel "),n("span",{class:"token operator"},"="),s(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateModel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建通道"),s(`

`),n("span",{class:"token comment"},"// 声明队列，如果该队列不存在，则会自动创建"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"QueueDeclare"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"durable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 设置队列为持久化"),s(`
                     exclusive`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoDelete"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"arguments"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},"Random"),s(" random "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" totalTimes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//总耗时"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" num "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//处理消息数"),s(`

`),n("span",{class:"token comment"},"// 创建一个事件基本消费者"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" consumer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"EventingBasicConsumer"),n("span",{class:"token punctuation"},"("),s("channel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
consumer`),n("span",{class:"token punctuation"},"."),s("Received "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("model"),n("span",{class:"token punctuation"},","),s(" ea"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},[s("ReadOnlyMemory"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token keyword"},"byte"),n("span",{class:"token punctuation"},">")]),s(" body "),n("span",{class:"token operator"},"="),s(" ea"),n("span",{class:"token punctuation"},"."),s("Body"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ToArray"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"string")]),s(" message "),n("span",{class:"token operator"},"="),s(" Encoding"),n("span",{class:"token punctuation"},"."),s("UTF8"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetString"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},"."),s("Span"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 收到消息：'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"message"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 模拟耗时的任务处理"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" time "),n("span",{class:"token operator"},"="),s(" random"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"5000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Task"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Delay"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 完成: 耗时'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"time"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 当消费者完成任务后，手动确认消息已经被消费"),s(`
    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicAck"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"deliveryTag"),n("span",{class:"token punctuation"},":"),s(" ea"),n("span",{class:"token punctuation"},"."),s("DeliveryTag"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token named-parameter punctuation"},"multiple"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    totalTimes `),n("span",{class:"token operator"},"+="),s(" time"),n("span",{class:"token punctuation"},";"),s(`
    num `),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 目前处理'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"num"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},"条消息，共耗时"),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"totalTimes"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 启动消费者"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicConsume"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoAck"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 关闭自动确认消息消费"),s(`
                     consumer`),n("span",{class:"token punctuation"},":"),s(" consumer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 指定消费者"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"按[Enter]键退出"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ReadLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),y=n("div",{class:"language-csharp line-numbers-mode","data-ext":"cs"},[n("pre",{class:"language-csharp"},[n("code",null,[n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client"),n("span",{class:"token punctuation"},"."),s("Events")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("System"),n("span",{class:"token punctuation"},"."),s("Text")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 创建连接工厂对象，指定主机名和登录凭据信息"),s(`
`),n("span",{class:"token class-name"},"ConnectionFactory"),s(" factory "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    HostName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"192.168.3.100"'),n("span",{class:"token punctuation"},","),s(`
    Port `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5672"),n("span",{class:"token punctuation"},","),s(`
    UserName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),n("span",{class:"token punctuation"},","),s(`
    Password `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" connection "),n("span",{class:"token operator"},"="),s(" factory"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateConnection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建连接"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" channel "),n("span",{class:"token operator"},"="),s(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateModel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建通道"),s(`

`),n("span",{class:"token comment"},"// 声明队列，如果该队列不存在，则会自动创建"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"QueueDeclare"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"durable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 设置队列为持久化"),s(`
                     exclusive`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoDelete"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"arguments"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},"Random"),s(" random "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" totalTimes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//总耗时"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" num "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//处理消息数"),s(`

`),n("span",{class:"token comment"},"// 创建一个事件基本消费者"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" consumer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"EventingBasicConsumer"),n("span",{class:"token punctuation"},"("),s("channel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
consumer`),n("span",{class:"token punctuation"},"."),s("Received "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("model"),n("span",{class:"token punctuation"},","),s(" ea"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},[s("ReadOnlyMemory"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token keyword"},"byte"),n("span",{class:"token punctuation"},">")]),s(" body "),n("span",{class:"token operator"},"="),s(" ea"),n("span",{class:"token punctuation"},"."),s("Body"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ToArray"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"string")]),s(" message "),n("span",{class:"token operator"},"="),s(" Encoding"),n("span",{class:"token punctuation"},"."),s("UTF8"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetString"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},"."),s("Span"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 收到消息：'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"message"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 模拟耗时的任务处理"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" time "),n("span",{class:"token operator"},"="),s(" random"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"5000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Task"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Delay"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 完成: 耗时'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"time"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 当消费者完成任务后，手动确认消息已经被消费"),s(`
    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicAck"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"deliveryTag"),n("span",{class:"token punctuation"},":"),s(" ea"),n("span",{class:"token punctuation"},"."),s("DeliveryTag"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token named-parameter punctuation"},"multiple"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    totalTimes `),n("span",{class:"token operator"},"+="),s(" time"),n("span",{class:"token punctuation"},";"),s(`
    num `),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 目前处理'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"num"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},"条消息，共耗时"),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"totalTimes"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 启动消费者"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicConsume"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoAck"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 关闭自动确认消息消费"),s(`
                     consumer`),n("span",{class:"token punctuation"},":"),s(" consumer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 指定消费者"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"按[Enter]键退出"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ReadLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),w=n("p",null,"分别启动消费者及生产者客户端，得到如下输出：",-1),f=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"1"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"2"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"3"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"4"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"5"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"6"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"7"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"9"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),_=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s(`按任意键退出
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"1"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"3"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"5"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"7"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"9"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时118ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理1条消息，共耗时118ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4135ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理2条消息，共耗时4253ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4324ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理3条消息，共耗时8577ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4512ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理4条消息，共耗时13089ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4575ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理5条消息，共耗时17664ms
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),C=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s(` 按任意键退出
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"2"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"4"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"6"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时286ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理1条消息，共耗时286ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时386ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理2条消息，共耗时672ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时1516ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理3条消息，共耗时2188ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时3755ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理4条消息，共耗时5943ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4894ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理5条消息，共耗时10837ms
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),x=p('<p>从输出结果中我们可以看到，消费者1和消费者2都处理了5条消息，但是耗时却相差距大，由此我们可以验证，在循环调度模式中，RabbitMQ 将消息平均分配给所有可用的消费者，而不考虑每个消费者的处理能力和负载情况。当消费者数量不变时，每个消费者将在轮换周期内依次接收到消息。</p><h2 id="公平调度" tabindex="-1"><a class="header-anchor" href="#公平调度" aria-hidden="true">#</a> 公平调度</h2><p>在公平调度模式中，RabbitMQ 会尝试将消息均匀地分配给所有可用的消费者，并确保每个消费者一次只接收一个消息。这样，即使某个消费者的处理时间较长或负载较重，也不会影响其他消费者的正常处理。</p><figure><img src="'+d+'" alt="公平调度" tabindex="0" loading="lazy"><figcaption>公平调度</figcaption></figure><h3 id="代码示例-1" tabindex="-1"><a class="header-anchor" href="#代码示例-1" aria-hidden="true">#</a> 代码示例</h3><p>生产者代码与<a href="#%E5%BE%AA%E7%8E%AF%E8%B0%83%E5%BA%A6">循环调度</a>中一致。</p>',6),T=n("div",{class:"language-csharp line-numbers-mode","data-ext":"cs"},[n("pre",{class:"language-csharp"},[n("code",null,[n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client"),n("span",{class:"token punctuation"},"."),s("Events")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("System"),n("span",{class:"token punctuation"},"."),s("Text")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 创建连接工厂对象，指定主机名和登录凭据信息"),s(`
`),n("span",{class:"token class-name"},"ConnectionFactory"),s(" factory "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    HostName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"192.168.3.100"'),n("span",{class:"token punctuation"},","),s(`
    Port `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5672"),n("span",{class:"token punctuation"},","),s(`
    UserName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),n("span",{class:"token punctuation"},","),s(`
    Password `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" connection "),n("span",{class:"token operator"},"="),s(" factory"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateConnection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建连接"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" channel "),n("span",{class:"token operator"},"="),s(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateModel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建通道"),s(`

`),n("span",{class:"token comment"},"// 声明队列，如果该队列不存在，则会自动创建"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"QueueDeclare"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"durable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 设置队列为持久化"),s(`
                     exclusive`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoDelete"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"arguments"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 设置每个消费者最多只能处理一条消息，避免某些消费者被过度负载而导致其他消费者处于空闲状态"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicQos"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},"Random"),s(" random "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" totalTimes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//总耗时"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" num "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//处理消息数"),s(`

`),n("span",{class:"token comment"},"// 创建一个事件基本消费者"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" consumer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"EventingBasicConsumer"),n("span",{class:"token punctuation"},"("),s("channel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
consumer`),n("span",{class:"token punctuation"},"."),s("Received "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("model"),n("span",{class:"token punctuation"},","),s(" ea"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},[s("ReadOnlyMemory"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token keyword"},"byte"),n("span",{class:"token punctuation"},">")]),s(" body "),n("span",{class:"token operator"},"="),s(" ea"),n("span",{class:"token punctuation"},"."),s("Body"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ToArray"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"string")]),s(" message "),n("span",{class:"token operator"},"="),s(" Encoding"),n("span",{class:"token punctuation"},"."),s("UTF8"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetString"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},"."),s("Span"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 收到消息：'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"message"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 模拟耗时的任务处理"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" time "),n("span",{class:"token operator"},"="),s(" random"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"5000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Task"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Delay"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 完成: 耗时'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"time"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 当消费者完成任务后，手动确认消息已经被消费"),s(`
    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicAck"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"deliveryTag"),n("span",{class:"token punctuation"},":"),s(" ea"),n("span",{class:"token punctuation"},"."),s("DeliveryTag"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token named-parameter punctuation"},"multiple"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    totalTimes `),n("span",{class:"token operator"},"+="),s(" time"),n("span",{class:"token punctuation"},";"),s(`
    num `),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者1] 目前处理'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"num"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},"条消息，共耗时"),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"totalTimes"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 启动消费者"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicConsume"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoAck"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 关闭自动确认消息消费"),s(`
                     consumer`),n("span",{class:"token punctuation"},":"),s(" consumer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 指定消费者"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'"按任意键退出"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ReadLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),R=n("div",{class:"language-csharp line-numbers-mode","data-ext":"cs"},[n("pre",{class:"language-csharp"},[n("code",null,[n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("RabbitMQ"),n("span",{class:"token punctuation"},"."),s("Client"),n("span",{class:"token punctuation"},"."),s("Events")]),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token namespace"},[s("System"),n("span",{class:"token punctuation"},"."),s("Text")]),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 创建连接工厂对象，指定主机名和登录凭据信息"),s(`
`),n("span",{class:"token class-name"},"ConnectionFactory"),s(" factory "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    HostName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"192.168.3.100"'),n("span",{class:"token punctuation"},","),s(`
    Port `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"5672"),n("span",{class:"token punctuation"},","),s(`
    UserName `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),n("span",{class:"token punctuation"},","),s(`
    Password `),n("span",{class:"token operator"},"="),s(),n("span",{class:"token string"},'"guest"'),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" connection "),n("span",{class:"token operator"},"="),s(" factory"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateConnection"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建连接"),s(`
`),n("span",{class:"token keyword"},"using"),s(),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" channel "),n("span",{class:"token operator"},"="),s(" connection"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"CreateModel"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 创建通道"),s(`

`),n("span",{class:"token comment"},"// 声明队列，如果该队列不存在，则会自动创建"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"QueueDeclare"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"durable"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"true"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 设置队列为持久化"),s(`
                     exclusive`),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoDelete"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"arguments"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token keyword"},"null"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token comment"},"// 设置每个消费者最多只能处理一条消息，避免某些消费者被过度负载而导致其他消费者处于空闲状态"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicQos"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},"Random"),s(" random "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" totalTimes "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//总耗时"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" num "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token number"},"0"),n("span",{class:"token punctuation"},";"),n("span",{class:"token comment"},"//处理消息数"),s(`

`),n("span",{class:"token comment"},"// 创建一个事件基本消费者"),s(`
`),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" consumer "),n("span",{class:"token operator"},"="),s(),n("span",{class:"token keyword"},"new"),s(),n("span",{class:"token constructor-invocation class-name"},"EventingBasicConsumer"),n("span",{class:"token punctuation"},"("),s("channel"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
consumer`),n("span",{class:"token punctuation"},"."),s("Received "),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token keyword"},"async"),s(),n("span",{class:"token punctuation"},"("),s("model"),n("span",{class:"token punctuation"},","),s(" ea"),n("span",{class:"token punctuation"},")"),s(),n("span",{class:"token operator"},"=>"),s(`
`),n("span",{class:"token punctuation"},"{"),s(`
    `),n("span",{class:"token class-name"},[s("ReadOnlyMemory"),n("span",{class:"token punctuation"},"<"),n("span",{class:"token keyword"},"byte"),n("span",{class:"token punctuation"},">")]),s(" body "),n("span",{class:"token operator"},"="),s(" ea"),n("span",{class:"token punctuation"},"."),s("Body"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ToArray"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"string")]),s(" message "),n("span",{class:"token operator"},"="),s(" Encoding"),n("span",{class:"token punctuation"},"."),s("UTF8"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"GetString"),n("span",{class:"token punctuation"},"("),s("body"),n("span",{class:"token punctuation"},"."),s("Span"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 收到消息：'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"message"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 模拟耗时的任务处理"),s(`
    `),n("span",{class:"token class-name"},[n("span",{class:"token keyword"},"var")]),s(" time "),n("span",{class:"token operator"},"="),s(" random"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Next"),n("span",{class:"token punctuation"},"("),n("span",{class:"token number"},"1000"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token number"},"5000"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
    `),n("span",{class:"token keyword"},"await"),s(" Task"),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"Delay"),n("span",{class:"token punctuation"},"("),s("time"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 完成: 耗时'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"time"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    `),n("span",{class:"token comment"},"// 当消费者完成任务后，手动确认消息已经被消费"),s(`
    channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicAck"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"deliveryTag"),n("span",{class:"token punctuation"},":"),s(" ea"),n("span",{class:"token punctuation"},"."),s("DeliveryTag"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token named-parameter punctuation"},"multiple"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`

    totalTimes `),n("span",{class:"token operator"},"+="),s(" time"),n("span",{class:"token punctuation"},";"),s(`
    num `),n("span",{class:"token operator"},"+="),s(),n("span",{class:"token number"},"1"),n("span",{class:"token punctuation"},";"),s(`

    Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token interpolation-string"},[n("span",{class:"token string"},'$"[消费者2] 目前处理'),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"num"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},"条消息，共耗时"),n("span",{class:"token interpolation"},[n("span",{class:"token punctuation"},"{"),n("span",{class:"token expression language-csharp"},"totalTimes"),n("span",{class:"token punctuation"},"}")]),n("span",{class:"token string"},'ms"')]),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token punctuation"},"}"),n("span",{class:"token punctuation"},";"),s(`
`),n("span",{class:"token comment"},"// 启动消费者"),s(`
channel`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"BasicConsume"),n("span",{class:"token punctuation"},"("),n("span",{class:"token named-parameter punctuation"},"queue"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token string"},'"work_queue"'),n("span",{class:"token punctuation"},","),s(`
                     `),n("span",{class:"token named-parameter punctuation"},"autoAck"),n("span",{class:"token punctuation"},":"),s(),n("span",{class:"token boolean"},"false"),n("span",{class:"token punctuation"},","),s(),n("span",{class:"token comment"},"// 关闭自动确认消息消费"),s(`
                     consumer`),n("span",{class:"token punctuation"},":"),s(" consumer"),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(),n("span",{class:"token comment"},"// 指定消费者"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"WriteLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token string"},'" 按任意键退出"'),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
Console`),n("span",{class:"token punctuation"},"."),n("span",{class:"token function"},"ReadLine"),n("span",{class:"token punctuation"},"("),n("span",{class:"token punctuation"},")"),n("span",{class:"token punctuation"},";"),s(`
`)])]),n("div",{class:"highlight-lines"},[n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("div",{class:"highlight-line"}," "),n("div",{class:"highlight-line"}," "),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),A=n("p",null,"分别启动消费者及生产者客户端，得到如下输出：",-1),B=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"1"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"2"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"3"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"4"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"5"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"6"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"7"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token punctuation"},"["),s("生产者"),n("span",{class:"token punctuation"},"]"),s(" 发送消息：任务消息 "),n("span",{class:"token number"},"9"),s(`
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),M=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s(`按任意键退出
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"1"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4609ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理1条消息，共耗时4609ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"3"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时1905ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理2条消息，共耗时6514ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"5"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时337ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理3条消息，共耗时6851ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"6"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时3092ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理4条消息，共耗时9943ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"8"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时2613ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理5条消息，共耗时12556ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"9"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时1898ms
`),n("span",{class:"token punctuation"},"["),s("消费者1"),n("span",{class:"token punctuation"},"]"),s(` 目前处理6条消息，共耗时14454ms
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),Q=n("div",{class:"language-bash line-numbers-mode","data-ext":"sh"},[n("pre",{class:"language-bash"},[n("code",null,[s(`按任意键退出
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"0"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时2560ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理1条消息，共耗时2560ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"2"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时3316ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理2条消息，共耗时5876ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"4"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时3738ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理3条消息，共耗时9614ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(" 收到消息：任务消息 "),n("span",{class:"token number"},"7"),s(`
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 完成: 耗时4111ms
`),n("span",{class:"token punctuation"},"["),s("消费者2"),n("span",{class:"token punctuation"},"]"),s(` 目前处理4条消息，共耗时13725m
`)])]),n("div",{class:"line-numbers","aria-hidden":"true"},[n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"}),n("div",{class:"line-number"})])],-1),E=n("p",null,"从输出结果中我们可以看到，消费者1和消费者2因为处理能力的不同，分别处理了不同数量的消息。",-1),L=n("p",null,[s("所以我们可以在代码中通过 "),n("code",null,"channel.BasicQos(0, 1, false)"),s(" 设置每个消费者最多只能处理一条消息，避免某些消费者被过度负载而导致其他消费者处于空闲状态。")],-1);function q(W,D){const c=i("Tabs");return k(),r("div",null,[v,l(c,{id:"42",data:[{title:"生产者"},{title:"消费者1"},{title:"消费者2"}]},{tab0:a(({title:t,value:e,isActive:o})=>[g]),tab1:a(({title:t,value:e,isActive:o})=>[h]),tab2:a(({title:t,value:e,isActive:o})=>[y]),_:1}),w,l(c,{id:"56",data:[{title:"生产者"},{title:"消费者1"},{title:"消费者2"}]},{tab0:a(({title:t,value:e,isActive:o})=>[f]),tab1:a(({title:t,value:e,isActive:o})=>[_]),tab2:a(({title:t,value:e,isActive:o})=>[C]),_:1}),x,l(c,{id:"85",data:[{title:"消费者1"},{title:"消费者2"}]},{tab0:a(({title:t,value:e,isActive:o})=>[T]),tab1:a(({title:t,value:e,isActive:o})=>[R]),_:1}),A,l(c,{id:"96",data:[{title:"生产者"},{title:"消费者1"},{title:"消费者2"}]},{tab0:a(({title:t,value:e,isActive:o})=>[B]),tab1:a(({title:t,value:e,isActive:o})=>[M]),tab2:a(({title:t,value:e,isActive:o})=>[Q]),_:1}),E,L])}const S=u(b,[["render",q],["__file","work-queue-mode.html.vue"]]);export{S as default};
